(function(c){var e=wp.media,d={},a={};var b=e.ajax;e.ajax=function(f){if("query-attachments"==f.data.action){stype=typeof arguments[0]["data"]["query"]["s"];if("object"==stype){s=arguments[0]["data"]["query"]["s"]}else{if("string"==stype){s={mla_search_value:arguments[0]["data"]["query"]["s"]}}else{s={}}}if("undefined"!=typeof s.mla_filter_month){a.filterMonth=s.mla_filter_month}if("undefined"!=typeof s.mla_filter_term){a.filterTerm=s.mla_filter_term}if("undefined"!=typeof s.mla_search_value){a.searchValue=s.mla_search_value}searchValues={mla_filter_month:a.filterMonth,mla_filter_term:a.filterTerm,mla_search_value:a.searchValue,mla_search_fields:a.searchFields,mla_search_connector:a.searchConnector};arguments[0]["data"]["query"]["s"]=searchValues}return b.apply(this,Array.prototype.slice.call(arguments))};d=typeof e.view.l10n.mla_strings==="undefined"?{}:e.view.l10n.mla_strings;delete e.view.l10n.mla_strings;a=typeof wp.media.view.settings.mla_settings==="undefined"?{}:wp.media.view.settings.mla_settings;delete wp.media.view.settings.mla_settings;e.view.AttachmentFilters.Mla=e.view.AttachmentFilters.extend({createFilters:function(){var f={};_.each(a.mimeTypes||{},function(h,g){f[g]={text:h,props:{type:g,uploadedTo:null,orderby:"date",order:"DESC"}}});f.all={text:e.view.l10n.allMediaItems,props:{type:null,uploadedTo:null,orderby:"date",order:"DESC"},priority:10};f.uploaded={text:e.view.l10n.uploadedToThisPost,props:{type:null,uploadedTo:e.view.settings.post.id,orderby:"menuOrder",order:"ASC"},priority:20};this.filters=f}});e.view.AttachmentFilters.MlaMonths=e.view.AttachmentFilters.extend({className:"attachment-months",createFilters:function(){var f={};_.each(a.months||{},function(h,g){f[g]={text:h,props:{s:{mla_filter_month:g}}}});this.filters=f},select:function(){var f=this.model,h=a.filterMonth,g=f.toJSON();if(_.isUndefined(g.s)){g.s={}}if("string"==typeof g.search){a.searchValue=g.search}if(_.isUndefined(g.s.mla_filter_month)){g.s.mla_filter_month=a.filterMonth}else{a.filterMonth=g.s.mla_filter_month}_.find(this.filters,function(j,k){var i=_.all(j.props,function(m,l){return m.mla_filter_month==a.filterMonth});if(i){return h=k}});this.$el.val(h)}});e.view.AttachmentFilters.MlaTerms=e.view.AttachmentFilters.extend({className:"attachment-terms",createFilters:function(){var f={};_.each(a.termsText||{},function(h,g){f[g]={text:h,props:{s:{mla_filter_term:parseInt(a.termsValue[g])}}}});this.filters=f},select:function(){var f=this.model,h=a.filterTerm,g=f.toJSON();if(_.isUndefined(g.s)){g.s={}}if("string"==typeof g.search){a.searchValue=g.search}if(_.isUndefined(g.s.mla_filter_term)){g.s.mla_filter_term=a.filterTerm}else{a.filterTerm=g.s.mla_filter_term}_.find(this.filters,function(j,k){var i=_.all(j.props,function(m,l){return m.mla_filter_term==a.filterTerm});if(i){return h=k}});this.$el.val(h)}});e.view.MlaSearch=e.View.extend({tagName:"div",className:"mla-search-box",template:e.template("mla-search-box"),attributes:{type:"mla-search-box",placeholder:d.searchBoxPlaceholder},events:{change:"search",click:"search",search:"search",MlaSearch:"search"},render:function(){this.$el.html(this.template());return this},search:function(f){if(("click"==f.type)&&("mla_search_submit"!=f.target.name)){return}switch(f.target.name){case"s[mla_search_value]":a.searchValue=f.target.value;case"mla_search_submit":searchValues={mla_filter_month:a.filterMonth,mla_filter_term:a.filterTerm,mla_search_value:a.searchValue,mla_search_fields:a.searchFields,mla_search_connector:a.searchConnector};this.model.set({s:searchValues});break;case"s[mla_search_connector]":a.searchConnector=f.target.value;break;case"s[mla_search_title]":index=a.searchFields.indexOf("title");if(-1==index){a.searchFields.push("title")}else{a.searchFields.splice(index,1)}break;case"s[mla_search_name]":index=a.searchFields.indexOf("name");if(-1==index){a.searchFields.push("name")}else{a.searchFields.splice(index,1)}break;case"s[mla_search_alt_text]":index=a.searchFields.indexOf("alt-text");if(-1==index){a.searchFields.push("alt-text")}else{a.searchFields.splice(index,1)}break;case"s[mla_search_excerpt]":index=a.searchFields.indexOf("excerpt");if(-1==index){a.searchFields.push("excerpt")}else{a.searchFields.splice(index,1)}break;case"s[mla_search_content]":index=a.searchFields.indexOf("content");if(-1==index){a.searchFields.push("content")}else{a.searchFields.splice(index,1)}break}}});if(a.enableMimeTypes||a.enableMonthsDropdown||a.enableTermsDropdown||a.enableSearchBox){e.view.AttachmentsBrowser=e.view.AttachmentsBrowser.extend({createToolbar:function(){var g,f;this.toolbar=new e.view.Toolbar({controller:this.controller});this.views.add(this.toolbar);g=this.options.filters;if("uploaded"===g){f=e.view.AttachmentFilters.Uploaded}else{if("all"===g){if(a.enableMimeTypes){f=e.view.AttachmentFilters.Mla}else{f=e.view.AttachmentFilters.All}}}if(f){this.toolbar.set("filters",new f({controller:this.controller,model:this.collection.props,priority:-80}).render())}if(g&&a.enableMonthsDropdown){this.toolbar.set("months",new e.view.AttachmentFilters.MlaMonths({controller:this.controller,model:this.collection.props,priority:-80}).render())}if(g&&a.enableTermsDropdown){this.toolbar.set("terms",new e.view.AttachmentFilters.MlaTerms({controller:this.controller,model:this.collection.props,priority:-80}).render())}if(this.options.search){if(a.enableSearchBox){this.toolbar.set("MlaSearch",new e.view.MlaSearch({controller:this.controller,model:this.collection.props,priority:60}).render())}else{this.toolbar.set("search",new e.view.Search({controller:this.controller,model:this.collection.props,priority:60}).render())}}if(this.options.dragInfo){this.toolbar.set("dragInfo",new e.View({el:c('<div class="instructions">'+e.view.l10n.dragInfo+"</div>")[0],priority:-40}))}}})}}(jQuery));